<!-- 
Richard Gray
2022
@goodgigs


 -->

<html>

<head>
    <title>SubCal.io</title>
    <style>
        @font-face {
            font-family: 'Shippori_Antique_B1';
            src: url('ShipporiAntiqueB1-Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
        
        body {
            background-color: rgb(255, 255, 255);
            margin: 0em;
            padding: 0em;
            font-family: 'Shippori_Antique_B1', Verdana, sans-serif;
        }
        
        #page {
            margin: auto;
            width: 100em;
        }
        
        #nav {
            color: white;
            font-size: 5em;
            font-weight: normal;
            background-color: black;
            padding-left: 0.2em;
            margin-bottom: 0.5em;
        }
        
        #footer {
            color: rgb(0, 0, 0);
            margin-left: 0.1em;
            font-size: 1em;
            position: absolute;
            bottom: 0.1em;
            right: 0.1em;
        }
        
        input,
        select,
        .row {
            font-size: 2em;
            font-family: 'Shippori_Antique_B1', Verdana, sans-serif;
        }
        
        .row div {
            display: inline
        }
        
        #hint {
            font-size: 1em;
        }
        
        .arrow {
            font-size: 2em;
        }
    </style>
    <script type="text/javascript">
        function update() {
            if (!(subnetdropdown.children.length > 0) && !(usableaddressesdropdown.children.length > 0)) {
                GenerateDropdowns()
            }
            validation = ValidateIPaddress(inputvalue.value)
            if (validation[0] && validation[1]) {
                inputvalue.style.background = "";
                ipaddress = inputvalue.value.split("/")[0]
                binaryipaddress = ConvertIpToBinary(ipaddress)
                ipaddressnumber = parseInt(binaryipaddress, 2).toString(10)
                subnetlength = inputvalue.value.split("/")[1]
                binarysubnetmask = ConvertSubnetToBinary(subnetlength)
                subnetmasknumber = parseInt(binarysubnetmask, 2).toString(10)
                subnetdropdown.value = subnetlength
                usableaddressesdropdown.value = subnetlength
                firsthostaddress.innerText = FirstUsableHost(ipaddressnumber, subnetmasknumber)
                lasthostaddress.innerText = LastUsableHost(ipaddressnumber, subnetmasknumber)
                usableaddresses.innerText = UsableAddresses(subnetlength)
                networkaddressdiv.innerText = NetworkAddress(ipaddressnumber, subnetmasknumber)
                broadcastaddress.innerText = BroadcastAddress(ipaddressnumber, subnetmasknumber)
            } else {
                inputvalue.style.background = "#f54242";
            }
        }

        function updatedropdown() {
            inputtemp = inputvalue.value.split("/")[0] + "/" + subnetdropdown.value
            validation = ValidateIPaddress(inputtemp)
            if (validation[0] && validation[1]) {
                inputvalue.style.background = "";
                inputvalue.value = inputtemp
                subnetdropdown.value = inputvalue.value.split("/")[1]
                update()
            } else {
                inputvalue.style.background = "#f54242";
            }
        }

        function updateusableaddressesdropdown() {
            inputtemp = inputvalue.value.split("/")[0] + "/" + usableaddressesdropdown.value
            validation = ValidateIPaddress(inputtemp)
            if (validation[0] && validation[1]) {
                inputvalue.style.background = "";
                inputvalue.value = inputtemp
                update()
            } else {
                inputvalue.style.background = "#f54242";
            }
        }


        function ValidateIPaddress(ipaddress) {

            var ip, subnet = false
            if (/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(?:\/((3[0-2])|([0-2]?[0-9]{1,1})))?$/.test(ipaddress)) {
                ip = true
            }
            if (/\/((3[0-2])|([0-2]?[0-9]{1,1}))$/.test(ipaddress)) {
                subnet = true
            }
            return [ip, subnet]

        }

        function ConvertIpToBinary(ipaddress) {
            var octets = ipaddress.split(".")
            return ConvertToByte(octets[0]) + ConvertToByte(octets[1]) + ConvertToByte(octets[2]) + ConvertToByte(octets[3])
        }

        function ConvertIpNumberToIpAddress(ipaddressnumber) {
            var octet = ipaddressnumber.toString(2).padStart(32, "0").match(/.{1,8}/g)
            return parseInt(octet[0], 2).toString(10) + "." + parseInt(octet[1], 2).toString(10) + "." + parseInt(octet[2], 2).toString(10) + "." + parseInt(octet[3], 2).toString(10)
        }

        function ConvertSubnetToBinary(subnetlength) {
            return ((2 ** subnetlength) - 1).toString(2).padEnd(32, "0")
        }

        function NetworkAddress(ipaddressnumber, subnetmasknumber) {
            networkaddress = (ipaddressnumber & subnetmasknumber) >>> 0
            return ConvertIpNumberToIpAddress(networkaddress)
        }

        function FirstUsableHost(ipaddressnumber, subnetmasknumber) {
            switch (subnetmasknumber) {
                case '4294967294':
                    firsthost = (ipaddressnumber & subnetmasknumber) >>> 0
                    return ConvertIpNumberToIpAddress(firsthost)
                case '4294967295':
                    firsthost = (ipaddressnumber & subnetmasknumber) >>> 0
                    return ConvertIpNumberToIpAddress(firsthost)
                default:
                    firsthost = ((ipaddressnumber & subnetmasknumber) + 1) >>> 0
                    return ConvertIpNumberToIpAddress(firsthost)
            }
        }

        function BroadcastAddress(ipaddressnumber, subnetmasknumber) {
            network = (ipaddressnumber & subnetmasknumber) >>> 0
            invertedsubnetmask = InvertBinary(subnetmasknumber, 32)
            lasthost = (network | invertedsubnetmask) >>> 0
            return ConvertIpNumberToIpAddress(lasthost)
        }

        function LastUsableHost(ipaddressnumber, subnetmasknumber) {
            switch (subnetmasknumber) {
                case '4294967294':
                    network = (ipaddressnumber & subnetmasknumber) >>> 0
                    invertedsubnetmask = InvertBinary(subnetmasknumber, 32)
                    lasthost = (network | invertedsubnetmask) >>> 0
                    return ConvertIpNumberToIpAddress(lasthost)
                case '4294967295':
                    network = (ipaddressnumber & subnetmasknumber) >>> 0
                    invertedsubnetmask = InvertBinary(subnetmasknumber, 32)
                    lasthost = (network | invertedsubnetmask) >>> 0
                    return ConvertIpNumberToIpAddress(lasthost)
                default:
                    network = (ipaddressnumber & subnetmasknumber) >>> 0
                    invertedsubnetmask = InvertBinary(subnetmasknumber, 32)
                    lasthost = ((network | invertedsubnetmask) - 1) >>> 0
                    return ConvertIpNumberToIpAddress(lasthost)
            }
        }

        function UsableAddresses(subnetlength) {
            switch (subnetlength) {
                case '31':
                    return 2
                case '32':
                    return 1
                default:
                    return ((2 ** (32 - subnetlength)) - 2);
            }

        }

        function ConvertToByte(number) {
            return (number >>> 0).toString(2).padStart(8, "0")
        }

        function InvertBinary(number, digits) {
            return ~number & (Math.pow(2, digits) - 1)
        }

        function CopyToClipboard(element) {
            var $temp = $("<input>");
            $("body").append($temp);
            $temp.val($(element).text()).select();
            document.execCommand("copy");
            $temp.remove();
        }

        function GenerateDropdowns() {
            var subnetdropdownoption = []
            var usableaddressesdropdownoption = []
            for (x = 32; x > 0; x--) {
                y = 33 - x
                subnetdropdownoption[x] = document.createElement("option")
                usableaddressesdropdownoption[x] = document.createElement("option")
                subnetdropdownoption[x].value = x.toString()
                subnetdropdownoption[x].text = "/" + x.toString()
                usableaddressesdropdownoption[x].value = x.toString()
                usableaddressesdropdownoption[x].text = UsableAddresses((33 - y).toString())
                subnetdropdown.add(subnetdropdownoption[x])
                usableaddressesdropdown.add(usableaddressesdropdownoption[x])
            }
        }

        document.onkeydown = function(e) {
            switch (e.keyCode) {
                case 40:
                    ipaddress = inputvalue.value.split("/")[0]
                    binaryipaddress = ConvertIpToBinary(ipaddress)
                    ipaddressnumber = parseInt(binaryipaddress, 2).toString(10)
                    subnetlength = inputvalue.value.split("/")[1]
                    binarysubnetmask = ConvertSubnetToBinary(subnetlength)
                    subnetmasknumber = parseInt(binarysubnetmask, 2).toString(10)
                    networkaddress = (ipaddressnumber & subnetmasknumber) >>> 0
                    nextnetworkaddress = (ipaddressnumber >>> 0) - (InvertBinary(subnetmasknumber, 32) >>> 0)
                    inputvalue.value = NetworkAddress(nextnetworkaddress, subnetmasknumber) + "/" + subnetlength
                    update()
                    break;
                case 39:
                    if (document.activeElement.id != "inputvalue") {
                        inputvalue.value = inputvalue.value.split("/")[0] + "/" + (parseInt(inputvalue.value.split("/")[1], 10) + 1)
                        update()
                    }
                    break;
                case 38:
                    ipaddress = inputvalue.value.split("/")[0]
                    binaryipaddress = ConvertIpToBinary(ipaddress)
                    ipaddressnumber = parseInt(binaryipaddress, 2).toString(10)
                    subnetlength = inputvalue.value.split("/")[1]
                    binarysubnetmask = ConvertSubnetToBinary(subnetlength)
                    subnetmasknumber = parseInt(binarysubnetmask, 2).toString(10)
                    networkaddress = (ipaddressnumber & subnetmasknumber) >>> 0
                    nextnetworkaddress = (ipaddressnumber >>> 0) + ((InvertBinary(subnetmasknumber, 32) >>> 0) + 1)
                    inputvalue.value = NetworkAddress(nextnetworkaddress, subnetmasknumber) + "/" + subnetlength
                    update()
                    break;
                case 37:
                    if (document.activeElement.id != "inputvalue") {
                        inputvalue.value = inputvalue.value.split("/")[0] + "/" + (parseInt(inputvalue.value.split("/")[1], 10) - 1)
                        update()
                    }
                    break;
            }
        }
    </script>

</head>

<body onload="update()">
    <div id='page'>
        <div id='nav'>subcal.io >_</div>
        <div id='calculator'>
            <input id="inputvalue" type="text" value="192.168.0.0/24" onchange="update()" oninput="update()"></input>
            <select id="subnetdropdown" onchange="updatedropdown()" oninput="updatedropdown()"></select>
            <select id="usableaddressesdropdown" onchange="updateusableaddressesdropdown()" oninput="updateusableaddressesdropdown()">
            </select>
            <div class="row">
                <div class="heading">First Host:</div>
                <div id="firsthostaddress"></div>
            </div>
            <div class="row">
                <div class="heading">Last Host:</div>
                <div id="lasthostaddress"></div>
            </div>
            <div class="row">
                <div class="heading">Usable Addresses:</div>
                <div id="usableaddresses"></div>
            </div>
            <div class="row">
                <div class="heading">Network Address:</div>
                <div class="item" id="networkaddressdiv"></div>
            </div>
            <div class="row">
                <div class="heading">Broadcast Address:</div>
                <div class="item" id="broadcastaddress"></div>
            </div>
        </div>
        <div id='hint'>Tip try using the arrow keys</div>
        <div id='footer'>subcal.io</div>
    </div>
</body>

</html>